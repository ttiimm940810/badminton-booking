<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¾½çƒ | æ™ºæ…§é ç´„ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
        .select-card input:checked + div { border-color: #4f46e5; background-color: #f5f3ff; }
        input:disabled + div { opacity: 0.3; pointer-events: none; background-color: #f1f5f9; }
    </style>
</head>
<body class="bg-[#F8FAFC] py-12 px-4">
    <div class="max-w-xl mx-auto">
        <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-200 overflow-hidden">
            <div class="h-2 bg-gradient-to-r from-indigo-700 to-slate-400"></div>
            <div class="p-8 md:p-12">
                <div class="mb-10 text-center">
                    <h1 class="text-3xl font-bold text-slate-900 mb-2">ğŸ¸ é¾ç¾½çƒ - é ç´„ç³»çµ±</h1>
                    <p class="text-slate-500 font-medium text-[10px] tracking-widest uppercase">Badminton Club</p>
                </div>

                <form id="bookingForm" class="space-y-8">
                    <section class="space-y-4">
                        <div class="flex items-center space-x-2"><span class="w-1.5 h-1.5 rounded-full bg-indigo-600"></span><h2 class="text-xs font-bold uppercase text-slate-400 tracking-widest">1. åŸºæœ¬è³‡è¨Š</h2></div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" name="name" required placeholder="å§“å" class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all">
                            <input type="tel" name="phone" required placeholder="é›»è©±" class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all">
                        </div>
                        <input type="text" name="lineID" placeholder="Line ID" required class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all">
                    </section>

                    <section class="space-y-3">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">2. é ç´„äººæ•¸</h2>
                        <div class="grid grid-cols-3 gap-2">
                            <label class="select-card cursor-pointer"><input type="radio" name="groupSize" value="1on1" class="sr-only peer" checked><div class="p-3 text-center rounded-xl border-2 border-slate-100 bg-white font-bold text-slate-600 text-[10px] transition-all">ğŸ‘¤ 1 on 1</div></label>
                            <label class="select-card cursor-pointer"><input type="radio" name="groupSize" value="1on2" class="sr-only peer"><div class="p-3 text-center rounded-xl border-2 border-slate-100 bg-white font-bold text-slate-600 text-[10px] transition-all">ğŸ‘¥ 1 on 2</div></label>
                            <label class="select-card cursor-pointer"><input type="radio" name="groupSize" value="1on4" class="sr-only peer"><div class="p-3 text-center rounded-xl border-2 border-slate-100 bg-white font-bold text-slate-600 text-[10px] transition-all">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ 4 äººåœ˜ç­</div></label>
                        </div>
                    </section>

                    <section class="space-y-4">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">3. é ç´„æ™‚æ®µ(4äººåœ˜ç­è«‹é¸2å°æ™‚) </h2>
                        <input type="date" name="date" id="dateSelector" required class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all mb-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <label class="relative"><input type="checkbox" name="timeSlot" value="08:00-09:00" data-index="0" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">08-09</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="09:00-10:00" data-index="1" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">09-10</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="10:00-11:00" data-index="2" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">10-11</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="11:00-12:00" data-index="3" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">11-12</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="13:00-14:00" data-index="4" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">13-14</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="14:00-15:00" data-index="5" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">14-15</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="15:00-16:00" data-index="6" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">15-16</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="16:00-17:00" data-index="7" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">16-17</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="17:00-18:00" data-index="8" data-fee="370" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-indigo-600 peer-checked:text-white cursor-pointer transition-all">17-18</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="18:00-19:00" data-index="9" data-fee="570" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-slate-900 peer-checked:text-white cursor-pointer transition-all">18-19</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="19:00-20:00" data-index="10" data-fee="570" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-slate-900 peer-checked:text-white cursor-pointer transition-all">19-20</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="20:00-21:00" data-index="11" data-fee="570" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-slate-900 peer-checked:text-white cursor-pointer transition-all">20-21</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="21:00-22:00" data-index="12" data-fee="570" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-slate-900 peer-checked:text-white cursor-pointer transition-all">21-22</div></label>
                            <label class="relative"><input type="checkbox" name="timeSlot" value="22:00-23:00" data-index="13" data-fee="570" class="sr-only peer"><div class="px-2 py-2 text-[10px] text-center font-bold rounded-xl border border-slate-200 peer-checked:bg-slate-900 peer-checked:text-white cursor-pointer transition-all">22-23</div></label>
                        </div>
                    </section>

                    <section class="space-y-3">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">4. é¸æ“‡æ–¹æ¡ˆ (åŒ…å«å ´åœ°è²»/äºº)</h2>
                        <div class="space-y-2">
                            <label class="select-card block cursor-pointer"><input type="radio" name="coursePlan" value="é«”é©—èª²" class="sr-only" checked><div class="p-4 rounded-2xl border-2 border-slate-100 bg-white flex justify-between items-center text-sm"><b>ğŸ”¹ é«”é©—èª²</b><span class="text-indigo-600 font-bold" id="label-experience">-- /äºº</span></div></label>
                            <label class="select-card block cursor-pointer"><input type="radio" name="coursePlan" value="å–®å ‚èª²" class="sr-only"><div class="p-4 rounded-2xl border-2 border-slate-100 bg-white flex justify-between items-center text-sm"><b>ğŸ”¹ å–®å ‚èª²</b><span class="text-indigo-600 font-bold" id="label-single">-- /äºº</span></div></label>
                            <label class="select-card block cursor-pointer"><input type="radio" name="coursePlan" value="10å ‚æ–¹æ¡ˆ" class="sr-only"><div class="p-4 rounded-2xl border-2 border-slate-100 bg-white flex justify-between items-center text-sm"><b>ğŸ”¹ 10 å ‚æ–¹æ¡ˆ</b><span class="text-indigo-600 font-bold" id="label-ten">-- /äºº</span></div></label>
                        </div>
                    </section>

                    <section class="space-y-4">
                        <div class="flex items-center space-x-2"><span class="w-1.5 h-1.5 rounded-full bg-indigo-600"></span><h2 class="text-xs font-bold uppercase text-slate-400 tracking-widest">5. é™„åŠ æœå‹™èˆ‡å‚™è¨»</h2></div>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center space-x-3 p-4 bg-slate-50 rounded-2xl cursor-pointer border-2 border-transparent transition-all"><input type="checkbox" name="services" value="çƒå…·è¨‚è³¼" class="w-4 h-4 rounded text-indigo-600"><span class="text-xs font-semibold text-slate-700">çƒå…·è¨‚è³¼</span></label>
                            <label class="flex items-center space-x-3 p-4 bg-slate-50 rounded-2xl cursor-pointer border-2 border-transparent transition-all"><input type="checkbox" name="services" value="æ‹‰ç·šæœå‹™ (BG65Ti)" class="w-4 h-4 rounded text-indigo-600"><span class="text-xs font-semibold text-slate-700">æ‹‰ç·š (BG65Ti) $320</span></label>
                        </div>
                        
                        <select name="venue" required class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all text-xs">
                            <option value="" disabled selected>è«‹é¸æ“‡ç·´çƒåœ°å€</option>
                            <option value="åŒ—å±¯">åŒ—å±¯</option><option value="å—å±¯">å—å±¯</option><option value="å¤ªå¹³">å¤ªå¹³</option><option value="è¥¿å±¯">è¥¿å±¯</option>
                            <option value="è¥¿å€">è¥¿å€</option><option value="æ±å€">æ±å€</option><option value="å—å€">å—å€</option><option value="æ–°ç«¹">æ–°ç«¹</option>
                        </select>

                        <textarea name="note" rows="2" placeholder="å¦‚æœ‰å…¶ä»–ç‰¹æ®Šå‚™è¨»è«‹å¡«å¯«..." class="w-full px-5 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none transition-all text-xs"></textarea>
                    </section>

                    <div class="mt-8">
                        <p class="text-[10px] text-slate-500 text-center mb-3 font-medium">â€» æœ€æ—©å¯é ç´„æ—¥æœŸç‚ºéš”å¤©</p>
                        <button type="submit" id="submitBtn" class="w-full bg-slate-900 text-white font-bold py-5 rounded-[1.5rem] hover:bg-indigo-700 transition-all shadow-xl flex items-center justify-center">
                            <span>ç¢ºèªæäº¤é ç´„</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="successModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white rounded-[2.5rem] p-10 max-sm w-full text-center shadow-2xl">
            <h2 class="text-2xl font-bold text-slate-900 mb-2">é ç´„æˆåŠŸ</h2>
            <p class="text-slate-500 mb-6">æ•™ç·´æœƒç›¡å¿«è¯çµ¡æ‚¨ï¼</p>
            <button onclick="location.reload()" class="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl transition-all">å®Œæˆ</button>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwlQUyHzsBdxaOQoqYCDaLkkd5HhS16V1644IT1pgevW6g70Opgbak-QvRY8wfKhXTIEg/exec';
        const form = document.getElementById('bookingForm');
        const dateInput = document.getElementById('dateSelector');
        const submitBtn = document.getElementById('submitBtn');
        
        const pricing = {
            '1on1':  { exp: 700, sgl: 800, ten: 7500, p: 1 },
            '1on2':  { p: 2 },
            '1on4':  { p: 4 }
        };

        function updateDateLimit() {
            const plan = form.querySelector('input[name="coursePlan"]:checked').value;
            const today = new Date();
            const tomorrow = new Date();
            
            // ğŸ“ ä¿®æ”¹ç‚º +1ï¼ˆéš”å¤©ï¼‰
            tomorrow.setDate(today.getDate() + 1);
            const minDateStr = tomorrow.toISOString().split('T')[0];
            dateInput.min = minDateStr;

            if (plan === "é«”é©—èª²" || plan === "å–®å ‚èª²") {
                const nextMonth = new Date();
                nextMonth.setDate(today.getDate() + 31);
                const maxDateStr = nextMonth.toISOString().split('T')[0];
                dateInput.max = maxDateStr;
                if (dateInput.value > maxDateStr || (dateInput.value < minDateStr && dateInput.value !== "")) {
                    dateInput.value = ""; resetSlots();
                }
            } else {
                dateInput.removeAttribute('max');
                if (dateInput.value < minDateStr && dateInput.value !== "") {
                    dateInput.value = ""; resetSlots();
                }
            }
        }

        function resetSlots() {
            form.querySelectorAll('input[name="timeSlot"]').forEach(cb => {
                const label = cb.closest('label'); cb.disabled = false; label.style.opacity = "1";
                label.style.pointerEvents = "auto"; 
                cb.nextElementSibling.innerText = cb.value.replace(/:00/g, ''); 
            });
            updatePricing();
        }

        function updatePricing() {
            const size = form.querySelector('input[name="groupSize"]:checked').value;
            const slots = Array.from(form.querySelectorAll('input[name="timeSlot"]:checked'));
            const expL = document.getElementById('label-experience'), sglL = document.getElementById('label-single'), tenL = document.getElementById('label-ten');
            
            if (slots.length === 0) {
                expL.innerText = "-- /äºº"; sglL.innerText = "-- /äºº"; tenL.innerText = "-- /äºº"; return;
            }

            if (size === '1on4') {
                expL.innerText = "$600 /äºº"; sglL.innerText = "$600 /äºº"; tenL.innerText = "$6000 /äºº"; return;
            }

            if (size === '1on2') {
                let trialTotal = 0, singleTotal = 0;
                let isNight = slots.some(s => parseInt(s.getAttribute('data-fee')) === 570);
                slots.forEach(s => {
                    const fee = parseInt(s.getAttribute('data-fee'));
                    trialTotal += (fee === 370) ? 540 : 640;
                    singleTotal += (fee === 370) ? 600 : 685;
                });
                expL.innerText = `$${trialTotal} /äºº`; sglL.innerText = `$${singleTotal} /äºº`;
                tenL.innerText = `$${isNight ? 6550 : 5700} /äºº`; return;
            }

            let venueTotal = 0; slots.forEach(s => venueTotal += parseInt(s.getAttribute('data-fee')));
            const pCount = pricing[size].p, hourCount = slots.length;
            const tExp = (pricing[size].exp * hourCount) + (venueTotal / pCount);
            const tSgl = (pricing[size].sgl * hourCount) + (venueTotal / pCount);
            const tTen = pricing[size].ten + (venueTotal * 10 / pCount);

            expL.innerText = `$${Math.round(tExp)} /äºº`; sglL.innerText = `$${Math.round(tSgl)} /äºº`;
            tenL.innerText = `$${Math.round(tTen)} /äºº`;
        }

        dateInput.addEventListener('change', function() {
            const selectedDate = this.value;
            if (!selectedDate) return;
            fetch(`${scriptURL}?date=${selectedDate}`)
                .then(response => response.json())
                .then(bookedSlots => {
                    form.querySelectorAll('input[name="timeSlot"]').forEach(cb => {
                        const label = cb.closest('label'), div = cb.nextElementSibling;
                        cb.disabled = false; label.style.opacity = "1"; label.style.pointerEvents = "auto";
                        div.innerText = cb.value.replace(/:00/g, ''); 
                        if (bookedSlots.includes(cb.value)) {
                            cb.disabled = true; cb.checked = false; label.style.opacity = "0.3";
                            label.style.pointerEvents = "none"; div.innerText = "å·²é ç´„";
                        }
                    });
                    updatePricing();
                });
        });

        form.addEventListener('change', (e) => {
            if (e.target.name === "coursePlan") updateDateLimit();
            updatePricing();
        });
        
        form.addEventListener('submit', e => {
            e.preventDefault();
            const size = form.querySelector('input[name="groupSize"]:checked').value;
            const slots = Array.from(form.querySelectorAll('input[name="timeSlot"]:checked'));

            if (size === '1on4') {
                if (slots.length !== 2) { alert("4äººåœ˜ç­èª²ç¨‹å›ºå®šç‚º 2 å°æ™‚ï¼Œè«‹é¸å–å‰›å¥½ 2 å€‹æ™‚æ®µï¼"); return; }
                const indices = slots.map(s => parseInt(s.getAttribute('data-index'))).sort((a, b) => a - b);
                if (indices[1] - indices[0] !== 1) { alert("4äººåœ˜ç­æ™‚æ®µå¿…é ˆé€£çºŒï¼"); return; }
            } else if (slots.length === 0) { alert("è«‹é¸æ“‡é ç´„æ™‚æ®µï¼"); return; }

            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>è³‡æ–™å‚³é€ä¸­...</span>`;

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.timeSlot = slots.map(cb => cb.value).join(', ');
            data.services = Array.from(form.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value).join(', ');
            data.secret_key = "LongTing_940810";

            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
            .then(() => { document.getElementById('successModal').classList.remove('hidden'); form.reset(); updatePricing(); updateDateLimit(); })
            .catch(() => alert('é ç´„å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'))
            .finally(() => { submitBtn.disabled = false; submitBtn.innerHTML = originalBtnContent; });
        });

        updateDateLimit();
    </script>
</body>
</html>
